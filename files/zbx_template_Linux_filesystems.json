{
  "zabbix_export": {
    "version": "4.4",
    "date": "2019-10-28T14:09:53Z",
    "groups": [
      {
        "name": "Templates/Modules"
      }
    ],
    "templates": [
      {
        "template": "Template Module Linux filesystems by Zabbix agent",
        "name": "Template Module Linux filesystems by Zabbix agent",
        "description": "Template tooling version used: 0.32",
        "groups": [
          {
            "name": "Templates/Modules"
          }
        ],
        "applications": [
          {
            "name": "Filesystems"
          }
        ],
        "discovery_rules": [
          {
            "name": "Mounted filesystem discovery",
            "key": "vfs.fs.discovery",
            "delay": "1h",
            "filter": {
              "evaltype": "AND",
              "conditions": [
                {
                  "macro": "{#FSTYPE}",
                  "value": "{$VFS.FS.FSTYPE.MATCHES}",
                  "formulaid": "D"
                },
                {
                  "macro": "{#FSTYPE}",
                  "value": "{$VFS.FS.FSTYPE.NOT_MATCHES}",
                  "operator": "NOT_MATCHES_REGEX",
                  "formulaid": "C"
                },
                {
                  "macro": "{#FSNAME}",
                  "value": "{$VFS.FS.FSNAME.MATCHES}",
                  "formulaid": "B"
                },
                {
                  "macro": "{#FSNAME}",
                  "value": "{$VFS.FS.FSNAME.NOT_MATCHES}",
                  "operator": "NOT_MATCHES_REGEX",
                  "formulaid": "A"
                }
              ]
            },
            "description": "Discovery of file systems of different types.",
            "item_prototypes": [
              {
                "name": "{#FSNAME}: Free inodes in %",
                "key": "vfs.fs.inode[{#FSNAME},pfree]",
                "history": "7d",
                "value_type": "FLOAT",
                "units": "%",
                "application_prototypes": [
                  {
                    "name": "Filesystem {#FSNAME}"
                  }
                ],
                "trigger_prototypes": [
                  {
                    "expression": "{min(5m)}<{$VFS.FS.INODE.PFREE.MIN.CRIT:\"{#FSNAME}\"}",
                    "name": "{#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.CRIT:\"{#FSNAME}\"}%)",
                    "opdata": "Free inodes: {ITEM.LASTVALUE1}",
                    "priority": "AVERAGE",
                    "description": "It may become impossible to write to disk if there are no index nodes left.\r\nAs symptoms, 'No space left on device' or 'Disk is full' errors may be seen even though free space is available."
                  },
                  {
                    "expression": "{min(5m)}<{$VFS.FS.INODE.PFREE.MIN.WARN:\"{#FSNAME}\"}",
                    "name": "{#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.WARN:\"{#FSNAME}\"}%)",
                    "opdata": "Free inodes: {ITEM.LASTVALUE1}",
                    "priority": "WARNING",
                    "description": "It may become impossible to write to disk if there are no index nodes left.\r\nAs symptoms, 'No space left on device' or 'Disk is full' errors may be seen even though free space is available.",
                    "dependencies": [
                      {
                        "name": "{#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.CRIT:\"{#FSNAME}\"}%)",
                        "expression": "{Template Module Linux filesystems by Zabbix agent:vfs.fs.inode[{#FSNAME},pfree].min(5m)}<{$VFS.FS.INODE.PFREE.MIN.CRIT:\"{#FSNAME}\"}"
                      }
                    ]
                  }
                ]
              },
              {
                "name": "{#FSNAME}: Space utilization",
                "key": "vfs.fs.size[{#FSNAME},pused]",
                "history": "7d",
                "value_type": "FLOAT",
                "units": "%",
                "description": "Space utilization in % for {#FSNAME}",
                "application_prototypes": [
                  {
                    "name": "Filesystem {#FSNAME}"
                  }
                ]
              },
              {
                "name": "{#FSNAME}: Total space",
                "key": "vfs.fs.size[{#FSNAME},total]",
                "history": "7d",
                "units": "B",
                "description": "Total space in Bytes",
                "application_prototypes": [
                  {
                    "name": "Filesystem {#FSNAME}"
                  }
                ]
              },
              {
                "name": "{#FSNAME}: Used space",
                "key": "vfs.fs.size[{#FSNAME},used]",
                "history": "7d",
                "units": "B",
                "description": "Used storage in Bytes",
                "application_prototypes": [
                  {
                    "name": "Filesystem {#FSNAME}"
                  }
                ]
              }
            ],
            "trigger_prototypes": [
              {
                "expression": "{Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},pused].last()}>{$VFS.FS.PUSED.MAX.CRIT:\"{#FSNAME}\"} and\r\n(({Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},total].last()}-{Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},used].last()})<5G or {Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},pused].timeleft(1h,,100)}<1d)",
                "name": "{#FSNAME}: Disk space is critically low (used > {$VFS.FS.PUSED.MAX.CRIT:\"{#FSNAME}\"}%)",
                "opdata": "Space used: {ITEM.LASTVALUE3} of {ITEM.LASTVALUE2} ({ITEM.LASTVALUE1})",
                "priority": "AVERAGE",
                "description": "Two conditions should match: First, space utilization should be above {$VFS.FS.PUSED.MAX.CRIT:\"{#FSNAME}\"}.\r\n Second condition should be one of the following:\r\n - The disk free space is less than 5G.\r\n - The disk will be full in less than 24 hours.",
                "manual_close": "YES"
              },
              {
                "expression": "{Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},pused].last()}>{$VFS.FS.PUSED.MAX.WARN:\"{#FSNAME}\"} and\r\n(({Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},total].last()}-{Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},used].last()})<10G or {Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},pused].timeleft(1h,,100)}<1d)",
                "name": "{#FSNAME}: Disk space is low (used > {$VFS.FS.PUSED.MAX.WARN:\"{#FSNAME}\"}%)",
                "opdata": "Space used: {ITEM.LASTVALUE3} of {ITEM.LASTVALUE2} ({ITEM.LASTVALUE1})",
                "priority": "WARNING",
                "description": "Two conditions should match: First, space utilization should be above {$VFS.FS.PUSED.MAX.CRIT:\"{#FSNAME}\"}.\r\n Second condition should be one of the following:\r\n - The disk free space is less than 10G.\r\n - The disk will be full in less than 24 hours.",
                "manual_close": "YES",
                "dependencies": [
                  {
                    "name": "{#FSNAME}: Disk space is critically low (used > {$VFS.FS.PUSED.MAX.CRIT:\"{#FSNAME}\"}%)",
                    "expression": "{Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},pused].last()}>{$VFS.FS.PUSED.MAX.CRIT:\"{#FSNAME}\"} and\r\n(({Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},total].last()}-{Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},used].last()})<5G or {Template Module Linux filesystems by Zabbix agent:vfs.fs.size[{#FSNAME},pused].timeleft(1h,,100)}<1d)"
                  }
                ]
              }
            ],
            "graph_prototypes": [
              {
                "name": "Disk space usage {#FSNAME} historical",
                "ymin_type_1": "FIXED",
                "graph_items": [
                  {
                    "drawtype": "FILLED_REGION",
                    "color": "1A7C11",
                    "item": {
                      "host": "Template Module Linux filesystems by Zabbix agent",
                      "key": "vfs.fs.size[{#FSNAME},total]"
                    }
                  },
                  {
                    "sortorder": "1",
                    "drawtype": "FILLED_REGION",
                    "color": "F63100",
                    "item": {
                      "host": "Template Module Linux filesystems by Zabbix agent",
                      "key": "vfs.fs.size[{#FSNAME},used]"
                    }
                  }
                ]
              },
              {
                "name": "{#FSNAME}: Disk space usage",
                "width": "600",
                "height": "340",
                "type": "PIE",
                "show_3d": "YES",
                "graph_items": [
                  {
                    "color": "969696",
                    "calc_fnc": "LAST",
                    "type": "GRAPH_SUM",
                    "item": {
                      "host": "Template Module Linux filesystems by Zabbix agent",
                      "key": "vfs.fs.size[{#FSNAME},total]"
                    }
                  },
                  {
                    "sortorder": "1",
                    "color": "C80000",
                    "calc_fnc": "LAST",
                    "item": {
                      "host": "Template Module Linux filesystems by Zabbix agent",
                      "key": "vfs.fs.size[{#FSNAME},used]"
                    }
                  }
                ]
              }
            ]
          }
        ],
        "macros": [
          {
            "macro": "{$VFS.FS.FSNAME.MATCHES}",
            "value": ".+",
            "description": "This macro is used in filesystems discovery. Can be overridden on the host or linked template level"
          },
          {
            "macro": "{$VFS.FS.FSNAME.NOT_MATCHES}",
            "value": "^(/dev|/sys|/run|/proc|.+/shm$)",
            "description": "This macro is used in filesystems discovery. Can be overridden on the host or linked template level"
          },
          {
            "macro": "{$VFS.FS.FSTYPE.MATCHES}",
            "value": "^(btrfs|ext2|ext3|ext4|reiser|xfs|ffs|ufs|jfs|jfs2|vxfs|hfs|apfs|refs|ntfs|fat32|zfs)$",
            "description": "This macro is used in filesystems discovery. Can be overridden on the host or linked template level"
          },
          {
            "macro": "{$VFS.FS.FSTYPE.NOT_MATCHES}",
            "value": "^\\s$",
            "description": "This macro is used in filesystems discovery. Can be overridden on the host or linked template level"
          },
          {
            "macro": "{$VFS.FS.INODE.PFREE.MIN.CRIT}",
            "value": "10"
          },
          {
            "macro": "{$VFS.FS.INODE.PFREE.MIN.WARN}",
            "value": "20"
          },
          {
            "macro": "{$VFS.FS.PUSED.MAX.CRIT}",
            "value": "90"
          },
          {
            "macro": "{$VFS.FS.PUSED.MAX.WARN}",
            "value": "80"
          }
        ]
      }
    ]
  }
}
